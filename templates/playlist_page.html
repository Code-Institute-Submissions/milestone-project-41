{% extends "base.html" %} {% block content %}
<div class="background-image">
	<div class="container">
		{%  if 'username' in session %}

		<div class="row">
			<div class="col s12">
				<div class="section-heading">Playlist</div>
			</div>
		</div>
		<div class="row">
			<div class="col s12">
				<ul class="collection with-header">
					<li class="collection-header">
						<h3>Your Playlist</h3>
					</li>
					<!-- <br> -->

					{% for idx, track_id, name in playlist_names %}
					<li class="collection-item" id="{{idx}}">
						{{loop.index}}. {{name}}
						<span class="current red-text"></span>
						<a href="{{url_for('playlist_delete', playlist_id=idx, track_id=track_id)}}" class="btn-small waves-effect waves-light right">Remove<i class="material-icons right">cancel</i></a>
					</li>
					{% endfor %}
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col s12 center-align">
				<a href="{{url_for('playlist_play')}}" class="btn-large waves-effect waves-light">Play
					Playlist<i class="material-icons right">play_circle_filled</i></a>
			</div>
		</div>


		{% else %}
		<div class="container">
			<div class="row">
				<div class="col s12">
					<div class="section-heading">Playlist</div>
				</div>
			</div>
			<div class="row">
				<div class="col s12">
					<p>To build your own playlist create your own account by signing up to our website</p>
					<p><a class="waves-effect waves-light btn-small" href="{{ url_for('loginpage') }}">Login</a></p>
				</div>
			</div>
		</div>
		{% endif %}
	</div>
</div>

<script type="text/javascript">
	// create playList array with each song ID
let playList = []
{% for id in playlist %}
    playList.push("{{id}}");
{% endfor %}

var tag = document.createElement('script');
tag.id = 'iframe-demo';
tag.src = 'https://www.youtube.com/iframe_api';
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player;

function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        videoId: playList[0],
        playerVars: {
            'autoplay': 1,
            'controls': 1
        },
        events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
        }
    });
}

function onPlayerReady(event) {
    document.getElementById('player').style.border = '5px solid #e487d8';
}

function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.ENDED) {
        $("#" + playList[0]).hide(); // hide the first song from 'upcoming' list
        playList.shift(); // remove first song from playList array
        if (playList.length != 0) {
            // play the next video in the playlist
            player.loadVideoById(playList[0]);
        } else {
            // auto-call @app.route('/catalogue')
            window.location.href = "/catalogue";
        }
    } else {
        // show which song is currently playing
        $("#" + playList[0] + " .current").text("(Currently Playing)");
    }
}
</script>


{% endblock %}